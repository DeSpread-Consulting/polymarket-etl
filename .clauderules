# 폴리마켓 커뮤니티 캘린더

Polymarket API → Supabase → Web (Vanilla JS)
5일 Week View + 3주 Calendar Overview

## 파일 구조
- `main.py`: ETL 파이프라인 (python main.py로 데이터 업데이트)
- `web/`: 정적 웹 (python3 -m http.server 8080)
- `web/app.js`: 렌더링 로직
- `web/style.css`: 스타일

## 필수 규칙

### DO ✅
- CHANGELOG 자동 업데이트 (절대 물어보지 말 것)
- 과거 이벤트 필터링: `endDate >= now` (항상)
- 이미지 로드 실패: `onerror="this.style.display='none'"`
- HTML 이스케이프: `escapeHtml()` 사용
- 링크 없는 이벤트: `disabled` 클래스 추가

### DON'T ❌
- CHANGELOG 업데이트 여부 묻지 말 것
- 단순 텍스트 변경은 파일 위치만 안내
- 이모지 사용 금지 (실제 이미지 사용)
- 과거 이벤트 표시 금지

### 솔직하게 말하기 💬
- 비효율적이거나 불가능한 요청: 바로 알려주고 대안 제시
- 토큰 낭비되는 작업: 더 효율적인 방법 제안
- 안될 것 같은 작업: 사전에 경고하고 이유 설명
- 예: "이 방법은 26,000건 처리하기엔 너무 느립니다. 대신 X 방법 추천"

## 디자인 규격

### 이미지 크기
- Week View: 24x24px, border-radius 4px
- Calendar Overview: 16x16px, border-radius 3px
- Modal: 32x32px, border-radius 6px

### 확률 색상
- 30% 미만: red (`.low`)
- 30-70%: yellow (`.mid`)
- 70% 이상: default

## 데이터
- 이벤트: ~26,000건
- 필드: id, title, slug, end_date, volume, probs, image_url, category, tags
- 그룹화: 동일 slug 합산 (`groupEventsBySlug`)
- 시간: UTC → KST 변환

## Database (Supabase)
- Supabase `.select()`는 기본 1000행만 반환. 대규모 조회 시 range 기반 페이지네이션 또는 RPC 사용 필수
- 서버 사이드 필터 (.neq(), .eq()) 적용 전 컬럼 타입 호환성 확인. 쿼리 에러 시 클라이언트 사이드 필터링으로 폴백. 커밋 전 반드시 테스트
- 대규모 배치 작업 (API 호출, 데이터 처리) 시 레이트 리밋, 지수 백오프, 진행 상황 리포팅을 처음부터 구현할 것 (실패 후가 아니라)

## JavaScript / Frontend
- 이벤트 리스너 (특히 DOMContentLoaded) 추가 시 파일에 이미 존재하는지 반드시 확인. 중복 핸들러 절대 금지
- 필터 추가나 데이터 가시성 변경은 명시적 사용자 승인 없이 절대 하지 말 것. 확률 필터 등 데이터를 몰래 숨기는 행위 금지. 필터를 제안할 때는 먼저 설명하고 확인을 기다릴 것

## Deployment (Vercel)
- Vercel 배포 이슈 디버깅 시: Root Directory 설정, 환경 변수, 빌드 설정을 .gitignore보다 먼저 확인. Git에 이미 추적 중인 파일은 .gitignore 영향을 받지 않음

## Debugging
- 로컬 서버/프로세스 실행 여부 확인 시 `lsof -i :<port>` 또는 `curl localhost:<port>` 사용. 프로세스 이름만으로 판단하지 말 것. 상태 보고 전 반드시 결과 확인
